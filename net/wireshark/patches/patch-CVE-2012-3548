$NetBSD: patch-CVE-2012-3548,v 1.1 2012/09/04 23:08:38 tron Exp $

Fix for the remote DoS security vulnerability reported in CVE-2012-3548.
The patch was taken from the Wireshark SVN repository:

http://anonsvn.wireshark.org/viewvc?view=revision&revision=44749

--- epan/dissectors/packet-drda.c.orig	2012-06-05 17:33:38.000000000 +0100
+++ epan/dissectors/packet-drda.c	2012-09-04 21:38:12.000000000 +0100
@@ -55,6 +55,7 @@
 #include <epan/packet.h>
 #include <epan/conversation.h>
 #include <epan/prefs.h>
+#include <epan/expert.h>
 #include "packet-tcp.h"
 
 static int proto_drda = -1;
@@ -696,6 +697,10 @@
     {
         iCommand = tvb_get_ntohs(tvb, offset + 8);
         iLength = tvb_get_ntohs(tvb, offset + 0);
+        if (iLength < 10) {
+            expert_add_info_format(pinfo, NULL, PI_MALFORMED, PI_ERROR, "Invalid length detected (%u): should be at least 10 bytes long", iLength);
+            break;
+        }
         /* iCommandEnd is the length of the packet up to the end of the current command */
         iCommandEnd += iLength;
 
